---
import Badge from "./Badge.astro";
import Layout from "../layouts/Layout.astro";
import SectionContainer from "./SectionContainer.astro";
import ContactForm from "./ContactForm.astro";
import Projects from "./Projects.astro";
import AboutMe from "./AboutMe.astro";
import GitHubIcon from "./icons/github.astro";
import LinkedinIcon from "./icons/linkedin.astro";
import MailIcon from "./icons/mail.astro";
import SocialPill from "./SocialPill.astro";
import CodeIcon from "./icons/code.astro";
import CopyIcon from "./icons/copy.astro";
import AboutIcon from "./icons/about.astro";
import Profile from "../assets/Profile_.png";
import { useTranslations, type Lang } from "../i18n/utils";

interface Props {
  lang: Lang;
}

const { lang } = Astro.props;
const t = useTranslations(lang);
---

<Layout title={t.title} lang={lang}>
  <main class="px-4">
    <SectionContainer id="top" aria-label="top" class="py-16 md:py-36">
      <img
        class="rounded-full size-20 mb-5 mt-24 border-2 border-teal-400"
        src={Profile.src}
        alt={t.hero.profileAlt}
      />
      <h1
        class="text-2xl md:text-3xl lg:text-4xl dark:text-white font-bold flex flex-row gap-x-4 pb-4"
      >
        {t.hero.greeting}
        <a
          href="https://github.com/FabrizioContu"
          target="_blank"
          rel="noopener"
          class="flex pt-1 items-center hover:scale-105 transition"
        >
          <Badge>{t.hero.badge}</Badge>
        </a>
      </h1>
      <h2
        class="opacity-80 text-xl md:text-2xl text-wrap"
        set:html={t.hero.descriptionHtml}
      />

      <nav class="flex flex-wrap gap-y-5 gap-x-6 mt-8">
        <SocialPill href="https://github.com/FabrizioContu">
          <GitHubIcon />
        </SocialPill>
        <SocialPill
          href="https://www.linkedin.com/in/fabrizio-contu-9b179b12a/"
        >
          <LinkedinIcon />
        </SocialPill>
        <SocialPill href="mailto:fab.contu@gmail.com">
          <MailIcon /> fab.contu@gmail.com
        </SocialPill>
        <SocialPill
          onclick="copyEmail()"
          title={t.hero.copyTitle}
          aria-label={t.hero.copyAriaLabel}
        >
          <CopyIcon />
        </SocialPill>

        <SocialPill
          href="CV.pdf"
          download="CV_Fabrizio_Contu.pdf"
          class="ml-4 px-3 py-2 text-white bg-teal-500 rounded-lg shadow hover:bg-teal-600 dark:hover:bg-teal-400 transition"
          aria-label={t.hero.downloadAriaLabel}
        >
          {t.hero.downloadCV}
        </SocialPill>
      </nav>
      <div
        id="email-alert"
        role="alert"
        class="rounded-xl border border-gray-100 bg-white/90 p-4 hidden mt-6 mx-40"
      >
        <div class="flex items-start gap-4">
          <span class="text-green-600">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
              class="size-6"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
              ></path>
            </svg>
          </span>

          <div class="flex-1">
            <strong class="block font-medium text-gray-900">
              {t.hero.emailCopiedLabel}
              <span class="text-teal-600 dark:text-teal-500 font-semibold"
                >fab.contu@gmail.com
              </span>{t.hero.emailCopiedSuffix}
            </strong>
          </div>

          <button
            class="text-gray-500 transition hover:text-gray-600"
            onclick="dismissAlert()"
          >
            <span class="sr-only">Dismiss popup</span>

            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
              class="size-6"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
      </div>
    </SectionContainer>

    <SectionContainer id="projects" aria-label="projects">
      <h2 class="text-3xl font-semibold mb-6 flex gap-x-3 items-center">
        <CodeIcon class="size-7" />
        {t.sections.projects}
      </h2>
      <Projects lang={lang} />
    </SectionContainer>

    <SectionContainer id="contact" aria-label="contact">
      <ContactForm lang={lang} />
    </SectionContainer>

    <SectionContainer id="about" aria-label="about">
      <h2 class="text-3xl font-semibold mb-6 flex gap-x-3 items-center">
        <AboutIcon class="size-7" />
        {t.sections.aboutMe}
      </h2>
      <AboutMe lang={lang} />
    </SectionContainer>
  </main>
</Layout>

<script is:inline>
  function copyEmail() {
    const email = "fab.contu@gmail.com";
    navigator.clipboard
      .writeText(email)
      .then(() => {
        const alert = document.getElementById("email-alert");
        alert.classList.remove("hidden");
        setTimeout(() => {
          alert.classList.add("hidden");
        }, 3000);
      })
      .catch((err) => {
        console.error("Could not copy the email", err);
      });
  }

  function dismissAlert() {
    const alert = document.getElementById("email-alert");
    alert.classList.add("hidden");
  }
</script>
